{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "data": {"url": "data/transformed_migrant_data_with_flags.csv", "format": {"type": "csv"}},
  "mark": {"type": "bar", "cornerRadiusTopLeft": 3, "cornerRadiusTopRight": 3},
  "width": "container",
  "height": 400,
  "params": [
    {
      "name": "Continent_selection",
      "bind": {
        "input": "select",
        "options": ["Asia", "Europe", "Africa", "Americas", "Oceania"],
        "name": "Continent Selection: "
      },
      "value": "Asia"
    },
    {
      "name": "Year_selection",
      "bind": {
        "input": "range",
        "min": 2020,
        "max": 2024,
        "step": 1,
        "name": "Select Year: "
      },
      "value": 2022
    }
  ],
  "transform": [
    {"filter": "datum.continent == Continent_selection"},
    {"filter": "datum.year == Year_selection"},
    {
      "calculate": "datum.Male_Migrants + datum.Female_Migrants",
      "as": "Total_Migrants"
    },
    {
      "window": [{"op": "rank", "as": "rank"}],
      "sort": [{"field": "Total_Migrants", "order": "descending"}]
    },
    {"filter": "datum.rank <= 10"},
    {
      "fold": ["Male_Migrants", "Female_Migrants"],
      "as": ["Gender", "Migrants"]
    },
    {
      "calculate": "datum.country_name + ' ' + datum.Country_Flag",
      "as": "Country_Label"
    }
  ],
  "encoding": {
    "x": {
      "field": "Country_Label",
      "type": "nominal",
      "title": "Country and Flag",
      "axis": {
        "labelAngle": 0,  
        "labelFontSize": 12
      }
    },
    "y": {
      "field": "Migrants",
      "type": "quantitative",
      "title": "Number of Migrants"
    },
    "color": {
      "field": "Gender",
      "type": "nominal",
      "scale": {"range": ["#ca8861", "#675193"]},
      "title": "Gender"
    },
    "tooltip": [
      {"field": "country_name", "title": "Country"},
      {"field": "Country_Flag", "title": "Flag"},
      {"field": "Gender", "title": "Gender"},
      {"field": "Migrants", "title": "Number of Migrants"},
      {"field": "year", "title": "Year"}
    ]
  }
}
