{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "data": {"url": "data/transformed_migrant_data_with_flags.csv", "format": {"type": "csv"}},
  "width": "container",
  "height": 400,
  "params": [
    {
      "name": "Continent_selection",
      "bind": {
        "input": "select",
        "options": ["Asia", "Europe", "Africa", "North America","Oceania"],
        "name": "Continent Selection: "
      },
      "value": "Asia"
    },
    {
      "name": "Year_selection",
      "bind": {
        "input": "range",
        "min": 2020,
        "max": 2024,
        "step": 1,
        "name": "Select Year: "
      },
      "value": 2022
    }
  ],
  "transform": [
    {"filter": "datum.continent == Continent_selection"},
    {"filter": "datum.year == Year_selection"},
    {
      "calculate": "datum.Male_Migrants + datum.Female_Migrants",
      "as": "Total_Migrants"
    },
    {
      "window": [{"op": "rank", "as": "rank"}],
      "sort": [{"field": "Total_Migrants", "order": "descending"}]
    },
    {"filter": "datum.rank <= 10"},
    {
      "fold": ["Male_Migrants", "Female_Migrants"],
      "as": ["Gender", "Migrants"]
    },
    {
      "calculate": "datum.Gender == 'Male_Migrants' ? 'Male' : 'Female'",
      "as": "Gender_Label"
    },
    {
      "calculate": "datum.country_name + ' ' + datum.Country_Flag",
      "as": "Country_Label"
    }
  ],
  "repeat": {"layer": ["Male_Migrants", "Female_Migrants"]},
  "spec": {
    "mark": "bar",
    "encoding": {
      "x": {
        "field": "Country_Label",
        "type": "nominal",
        "title": "Country and Flag",
        "axis": {
          "labelAngle": -45,
          "labelFontSize": 14
        }
      },
      "y": {
        "aggregate": "sum",
        "field": "Migrants",
        "type": "quantitative",
        "title": "Number of Migrants",
        "scale": {
          "type": "log"
        },
        "axis": {
          "labelFontSize": 12,
          "grid": true
        }
      },
      "color": {
        "field": "Gender_Label",
        "scale": {
          "domain": ["Female", "Male"],
          "range": ["#FFA500", "#1E90FF"]
        },
        "title": "Gender"
      },
      "xOffset": {"field": "Gender_Label"},
      "tooltip": [
        {"field": "country_name", "title": "Country"},
        {"field": "Country_Flag", "title": "Flag"},
        {"field": "Gender_Label", "title": "Gender"},
        {
          "field": "Migrants",
          "title": "Number of Migrants",
          "type": "quantitative",
          "format": ","
        },
        {"field": "year", "title": "Year"}
      ]
    }
  },
  "config": {
    "axisX": {
      "labelPadding": 10,
      "titleFontSize": 14
    },
    "axisY": {
      "titleFontSize": 14,
      "labelFontSize": 12
    },
    "mark": {"invalid": null}
  }
}
